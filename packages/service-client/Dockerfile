FROM node:16.15.1-alpine
WORKDIR ./app
COPY ../../. .

RUN yarn --frozen-lockfile \
    && rm -rf /usr/local/share/.cache \
    && rm -rf /root/.npm

WORKDIR ./packages/service-client

ARG NEXT_PUBLIC_SG_SERVER
ARG NEXT_PUBLIC_PRODUCTION_ENVIRONMENT
ARG NEXT_PUBLIC_TITLE

ENV NODE_ENV=production
ENV NEXT_PUBLIC_SG_SERVER ${NEXT_PUBLIC_SG_SERVER}
ENV NEXT_PUBLIC_PRODUCTION_ENVIRONMENT ${NEXT_PUBLIC_PRODUCTION_ENVIRONMENT}
ENV NEXT_PUBLIC_TITLE ${NEXT_PUBLIC_TITLE}

RUN yarn build

CMD ["yarn", "start"]
